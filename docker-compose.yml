version: "3.8"
services:
  mongodb:
    image: mongo:4.4
    restart: on-failure
    container_name: mongodb
    volumes: 
      - mongo_db:/data/db


  oanda_bigquery:
    build: ./services/oanda_bigquery
    image: gcr.io/brushed-charts/oanda_bigquery:${PROFIL}-latest
    container_name: oanda_bigquery 
    env_file: 
      - ./env/services.env
      - ./env/services.${PROFIL}.env
    volumes: 
      - type: bind
        source: /etc/brushed-charts/
        target: /etc/brushed-charts/


  oanda_fetcher:
    build: ./services/oanda_fetcher
    image: gcr.io/brushed-charts/oanda_fetcher:${PROFIL}-latest
    container_name: oanda_fetcher
    env_file: 
      - ./env/services.env
      - ./env/oanda_secret.env
      - ./env/services.${PROFIL}.env
    volumes: 
      - type: bind
        source: /etc/brushed-charts/
        target: /etc/brushed-charts/


  oanda_history:
    build: ./services/oanda_history
    image: gcr.io/brushed-charts/oanda_history:${PROFIL}-latest
    container_name: oanda_history
    env_file: 
      - ./env/services.env
      - ./env/services.${PROFIL}.env
    volumes: 
      - type: bind
        source: /etc/brushed-charts/
        target: /etc/brushed-charts/


  oanda_watchlist:
    build: ./services/oanda_watchlist
    image: gcr.io/brushed-charts/oanda_watchlist:${PROFIL}-latest
    container_name: oanda_watchlist
    env_file: 
      - ./env/services.env
      - ./env/services.${PROFIL}.env
    volumes: 
      - type: bind
        source: /etc/brushed-charts/
        target: /etc/brushed-charts/
        
        
volumes: 
  mongo_db: